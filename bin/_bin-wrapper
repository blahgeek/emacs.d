#!/bin/bash

source="$1"
shift

cmd="$(basename "$source")"
script_dir="$(dirname "$(readlink -f "${BASH_SOURCE[0]}")")"
exe_path=
extra_args=()
prefix_args=()

IFS=: read -ra dirs <<<"$PATH"
for d in "${dirs[@]}"; do
    [[ "$d" == "$script_dir" ]] && continue   # skip own directory
    if [[ -x "$d/$cmd" && ! -d "$d/$cmd" ]]; then
        exe_path="$d/$cmd"
        break
    fi
done

if [[ -z "$exe_path" ]]; then
    echo "ERROR: $cmd not found in PATH"
    exit 1
fi

source "$source"
exec "${prefix_args[@]}" "$exe_path" "${extra_args[@]}" "$@"
