#!/usr/bin/env _bin-wrapper

function get_api_key(){
    local host="$1"
    local api_key="$(emacsclient-on-current-server -e "(gptel-api-key-from-auth-source \"$host\")")"
    # trim surrounding quote
    api_key="${api_key%\"}"
    api_key="${api_key#\"}"
    echo "$api_key"
}

API_KEY="$(get_api_key api.anthropic.com)"

echo "Using api_key $API_KEY"
export ANTHROPIC_API_KEY="$API_KEY"
